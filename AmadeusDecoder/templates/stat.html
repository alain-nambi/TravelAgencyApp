{% extends 'layout-all-pnr.html' %}
{% block content %}
<div class="content-wrapper">
    <section class="content" style="margin-top: 4.7rem">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card card-primary card-outline" style="margin-top: 4rem !important;">
                        <div class="card-header justify-content-between py-0">
                            <div class="row">
                                <div class="col-md-6 float-left">
                                    <h4 class="text-primary title-all-pnr mt-1 mb-0">Gestion Anomalies</h4>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div id="chartContainer_2" style="width: 100%; height: 560px;"></div>
                                </div>
                                <div class="col-md-6">
                                    <div id="chartContainer" style="width: 100%; height: 560px;"></div>
                                </div>
                            </div>
                            
                            <div id="chartContainer_3" style="width: 75%; height: 360px;"></div>
                            <div id="chartContainer_4" style="width: 75%; height: 360px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<script>
    window.onload = function () {
        console.log('coucou')
        var chart = new CanvasJS.Chart("chartContainer", {
            exportEnabled: true,
            animationEnabled: true,
            title: {
                text: "Passagers par tranche d'âge"
            },
            data: [{
                type: "pie",
                legendText: "{label}",
                yValueFormatString: "#,###\"%\"",
                indexLabel: "{label} ({y})",
                dataPoints: {{ passenger_by_age|safe }}
            }]
        });

        chart.render();

        var Destination_data = {{all_data|safe}}
        

        var chart_2 = new CanvasJS.Chart("chartContainer_2", {
            theme: "light2",
            title:{
              text: "Destinations"
            },
            toolTip: {
              shared: true
            },
            axisY: {
              title: "Nombre de passager",
              valueFormatString: "#,##0.##"
            },
            legend: {
              cursor: "pointer",
              itemclick: toggleDataSeries
            },
            data: Destination_data.map((element) => ({
                type: "bar",
                name: element[0],
                showInLegend: true,
                yValueFormatString: "#,##0.##",
                dataPoints: element.slice(1) // Utiliser slice(1) pour obtenir tous les éléments sauf le premier
            }))
        });
        chart_2.render();

        var chart_3 = new CanvasJS.Chart("chartContainer_3", {
            theme: "light2",
            title:{
              text: "Origines"
            },
            toolTip: {
              shared: true
            },
            axisY: {
              title: "Nombre de passager",
              valueFormatString: "#,##0.##"
            },
            legend: {
              cursor: "pointer",
              itemclick: toggleDataSeries
            },
            data: Destination_data.map((element) => ({
                type: "bar",
                name: element[0],
                showInLegend: true,
                yValueFormatString: "#,##0.##",
                dataPoints: element.slice(1) // Utiliser slice(1) pour obtenir tous les éléments sauf le premier
            }))
        });
        chart_3.render();

        var airline_data = {{all_data_airline|safe}}
        var chart_4 = new CanvasJS.Chart("chartContainer_4", {
            theme: "light2",
            title: {
              text: "Step Count Over a Week"
            },
            axisY: {
              title: "Nombre de Passager",
              stripLines: [{
                value: 10000,
                label: "Goal"
              }]
            },
            
            data: airline_data.map((element) => ({
                type: "line",
                name: element[0],
                showInLegend: true,
                yValueFormatString: "#,### Person",
                dataPoints: element.slice(1)
            }))
          });
          chart_4.render();

        
        
        function toggleDataSeries(e) {
            if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                e.dataSeries.visible = false;
            } else {
                e.dataSeries.visible = true;
            }
            e.chart.render();
        }

    }


</script>
{% endblock content %}
